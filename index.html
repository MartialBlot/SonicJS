
<canvas id="sonic" style="margin: auto"></canvas>

<script>
    //Taille du Canvas
    let canvasWidth = 1200; 
    let canvasHeight = 800;
    
    //Taille du sprite
    let spriteWidth = 540; 
    let spriteHeight = 1080; 
    
    //Structure du sprite
    let rows = 9; 
    let cols = 6; 
    
    //Taille/structure Sprite
    let width = spriteWidth/cols;  
    let height = spriteHeight/rows; 
    
    //Premiere image
    let curFrame = 0; 
    
    //Total images
    let frameCount = 6; 
    
    //Coordonées sprite
    let x=400;
    let y=450; 
    
    //x and y coordinates of the canvas to get the single frame 
    let srcX= 0; 
    let srcY= 0; 
    
    //Coordonnées background
    let bX = 0;
    let bY = 0;
    let tBX = bX;
    let tBY = bY;
    
    let canvas = document.getElementById('sonic');
    
    //Propriété du Canvas
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    let background = new Image();
    background.src = "./images/maptest.png";
    
    let ctx = canvas.getContext("2d");
    
    //Creation de Sonic
    let sonic = new Image(); 
    sonic.src = "./images/sonic.png";
    
    
    function updateFrame(){
        //Rafraichissement 
        curFrame = ++curFrame % frameCount; 
        //Calcul coordonnées du sprite
        srcX = curFrame * width; 
        ctx.clearRect(x,y,width,height);
    }
    
    //Controls
    
    let keyState = {};    
    document.addEventListener('keydown',function(e){
        keyState[e.keyCode || e.which] = true;
    },true);    
    document.addEventListener('keyup',function(e){
        keyState[e.keyCode || e.which] = false;
        initDroit()
    },true);
    
    function gameLoop() {
        //Control droit
        if (keyState[39] || keyState[68]){
            bX += 2;
            droite();
        }
        if (keyState[39]&& keyState[16] || keyState[68] && keyState[16]){
            bX += 3;
            courirDroit();
        }
        //Control gauche
        if (keyState[37] || keyState[65]){
            bX -= 2;
            gauche();
        }
        if (keyState[37]&& keyState[16] || keyState[65] && keyState[16]){
            bX -= 3;
            courirGauche();
        }    
        //Control Boule
        if (keyState[83] || keyState[40]){
            boule();
            if (keyState[39]&& keyState[16] || keyState[68] && keyState[16]){
                bX += 3;
                bouleRapideDroit();
                }
            if (keyState[37]&& keyState[16] || keyState[65] && keyState[16]){
                bX -= 3;
                bouleRapideGauche();
                }
        }
        
        setTimeout(gameLoop, 10);
    }    
    gameLoop();
    
    function draw(){
        //Rafraichissement
        updateFrame();
        ctx.drawImage(background,bX,bY,1400,1080,0,0,1200,800);
        
        let projection =  ctx.drawImage(sonic,srcX,srcY,width,height,x,y,width,height);
    }
    
    function initDroit(){
        rows = 9; 
        cols = 6; 
        spriteWidth = 540; 
        spriteHeight = 1080;
        width = spriteWidth/cols;  
        height = spriteHeight/rows;
        frameCount = 6; 
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 0;
    }
    
    function initGauche(){
        rows = 9; 
        cols = 6; 
        spriteWidth = 540; 
        spriteHeight = 1080;
        width = spriteWidth/cols;  
        height = spriteHeight/rows;
        frameCount = 6; 
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 715;
    }
    
    function droite(){
        rows = 9; 
        cols = 3;
        spriteWidth = 288; 
        spriteHeight = 1080; 
        width = spriteWidth/cols;  
        height = spriteHeight/rows; 
        frameCount = 3;
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 130;
    }
    
    function gauche(){
        rows = 9; 
        cols = 3;
        spriteWidth = 285; 
        spriteHeight = 1080; 
        width = spriteWidth/cols;  
        height = spriteHeight/rows; 
        frameCount = 3;
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 590;
    }
    
    function boule(){
        rows = 9; 
        cols = 4;
        spriteWidth = 289; 
        spriteHeight = 600; 
        width = spriteWidth/cols;  
        height = spriteHeight/rows; 
        frameCount = 4;
        x=400;
        y=510; 
        srcX= 0; 
        srcY= 380;
    }

    function bouleRapideDroit(){
        rows = 9; 
        cols = 3;
        spriteWidth = 330; 
        spriteHeight = 630; 
        width = spriteWidth/cols;  
        height = spriteHeight/rows; 
        frameCount = 3;
        x=400;
        y=500; 
        srcX= 0; 
        srcY= 980;
    }

    function bouleRapideGauche(){
        rows = 9; 
        cols = 3;
        spriteWidth = 330; 
        spriteHeight = 630; 
        width = spriteWidth/cols;  
        height = spriteHeight/rows; 
        frameCount = 3;
        x=400;
        y=500; 
        srcX= 0; 
        srcY= 1065;
    }
    
    function courirDroit(){
        rows = 9; 
        cols = 4; 
        spriteWidth = 400; 
        spriteHeight = 1080;
        width = spriteWidth/cols;  
        height = spriteHeight/rows;
        frameCount = 4; 
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 258;
    }
    
    function courirGauche(){
        rows = 9; 
        cols = 4; 
        spriteWidth = 440; 
        spriteHeight = 1080;
        width = spriteWidth/cols;  
        height = spriteHeight/rows;
        frameCount = 4; 
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 850;
    }
    
    function saut(){
        rows = 9; 
        cols = 5; 
        spriteWidth = 450; 
        spriteHeight = 1100;
        width = spriteWidth/cols;  
        height = spriteHeight/rows;
        frameCount = 4; 
        x=400;
        y=450; 
        srcX= 0; 
        srcY= 456;
        setTimeout(initDroit,500)
    }
    
    setInterval(draw,100);
    
    
</script>